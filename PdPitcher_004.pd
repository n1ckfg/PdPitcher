#N canvas 499 60 1902 1062 10;
#X text 1537 24 sigmund~ - sinusoidal analysis and pitch tracking;
#N canvas 432 117 573 597 using-with-tables 0;
#X obj 29 368 print peak;
#N canvas 0 50 450 300 (subpatch) 0;
#X array insignal 1024 float 2;
#X coords 0 1 1023 -1 200 140 1;
#X restore 83 426 graph;
#X obj 314 513 phasor~;
#X obj 294 429 loadbang;
#X obj 314 461 440;
#X floatatom 313 488 5 0 0 0 - - -;
#X obj 305 544 tabwrite~ insignal;
#X obj 290 516 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X text 114 11 Using sigmund~ on arrays;
#X text 42 33 If invoked with the "-t" flag (as a creation argument)
\, sigmund~ analyzes waveforms stored in arrays. Instead of an incoming
signal \, feed it "list" messages with the following arguments:;
#X text 37 118 table name (a symbol);
#X text 38 137 number of points;
#X obj 29 342 sigmund~ -t -npeak 10 -maxfreq 5000 peaks;
#X msg 29 316 list insignal 1024 0 44100 0;
#X text 37 158 index of first point;
#X text 39 179 sample rate;
#X text 38 200 debug flag (print debugging info if nonzero);
#X text 23 232 In this mode \, only the "env" \, "pitch" \, and "peaks"
outputs are meaningful.;
#X text 31 294 click here to test:;
#X connect 2 0 6 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 2 0;
#X connect 5 0 7 0;
#X connect 7 0 6 0;
#X connect 12 0 0 0;
#X connect 13 0 12 0;
#X restore 1690 564 pd using-with-tables;
#X obj 1539 484 loadbang;
#X floatatom 1048 170 5 0 120 0 - - -;
#X text 1508 48 Sigmund~ analyzes an incoming sound into sinusoidal
components \, which may be reported individually or combined to form
a pitch estimate. Possible outputs are specified as creation arguments:
;
#X text 1551 115 pitch - output pitch continuously;
#N canvas 517 73 588 728 setting-parameters 0;
#X msg 182 66 print;
#X floatatom 192 92 5 0 0 0 - - -;
#X msg 192 113 minpower \$1;
#X obj 182 139 sigmund~ -minpower 40;
#X text 39 14 You can set parameters either by creation arguments \,
or else using messages. The "print" message gives you the current values
of all the parameters:;
#X text 28 169 npts: number of points used in an analysis. Must be
a power of two \, at least 128 The minimum frequency that can be tracked
is about 2(sample_rate)/npts.;
#X text 26 219 hop: number of points between analyses. Must be a power
of two \, at least the DSP vector size (usually 64). This regulates
the number of analyses done per unit of time.;
#X text 28 271 npeak: maximum number of sinusoidal peaks to look for.
The computation time is quadratic in the number of peaks actually found
(this number only sets an upper limit). Use it to balance CPU time
with quality of results.;
#X text 30 336 maxfreq: maximum frequency of sinusoidal peaks to look
for. This can be useful in situations where background noise creates
high-frequency \, spurious peaks..;
#X text 37 388 vibrato: maximum deviation from "pitch" to accept as
normal vibrato (affects "notes" output only). If the value is too small.
vibratos will appear as trills. If too large \, very small melodic
intervals may not be reported as new notes.;
#X text 33 457 stabletime: time period to wait before reporting a note
(affects "notes" output only). The "pitch" must be present and must
not vary more than "vibrato" for this entire period to report a note.
If too large \, the "notes" will be unnecessarily delayed. If too small
\, spurious notes get output.;
#X text 34 606 growth: minimum measured RMS growth to report a new
note (affects "notes" output only). The RMS level must rise by this
many dB (within a time period given by "stabletime") to report a repetition
of a note at or near the previously output pitch.;
#X text 33 555 minpower: minimum measured RMS level to report a pitch
(affects "notes" output only). Signals quieter than this will be assumed
to be crosstalk and ignored.;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X restore 1690 542 pd setting-parameters;
#N canvas 67 50 641 815 sinusoid-tracking 0;
#X obj 124 267 sigmund~ -npeak 10 peaks;
#X obj 124 214 phasor~;
#X obj 124 144 loadbang;
#X floatatom 124 190 5 0 120 0 - - -;
#X obj 124 295 route 0 1 2 3 4 5 6 7 8 9;
#X obj 82 339 unpack 0 0 0 0;
#X floatatom 82 461 5 0 0 0 - - -;
#X floatatom 122 431 5 0 0 0 - - -;
#X floatatom 162 406 5 0 0 0 - - -;
#X obj 124 167 440;
#X floatatom 203 380 5 0 0 0 - - -;
#X obj 322 349 unpack 0 0 0 0;
#X floatatom 322 471 5 0 0 0 - - -;
#X floatatom 362 441 5 0 0 0 - - -;
#X floatatom 402 416 5 0 0 0 - - -;
#X floatatom 443 390 5 0 0 0 - - -;
#X text 385 475 frequency (Hz.);
#X text 419 442 peak amplitude (linear);
#X text 464 416 cosine component;
#X text 499 390 sine component;
#X text 79 505 loudest partial;
#X text 332 508 quietest partial;
#X text 36 4 You can ask for sinusoidal peaks in decreasing order of
amplitude or arranged into maximally continuous tracks for resynthesis.
(Or you can ask for both.) If you ask for peaks \, out come lists of
five numbers \, one for each sinusoid at each analysis period. The
first is the index number of the sinusoid (so you can use "route" to
claw them apart). The other four are as shown:;
#X obj 204 611 osc~ 440;
#X obj 204 635 *~;
#X obj 205 689 unpack 0 0 0 0;
#X floatatom 205 782 5 0 0 0 - - -;
#X floatatom 245 760 5 0 0 0 - - -;
#X floatatom 285 737 5 0 0 0 - - -;
#X floatatom 326 713 5 0 0 0 - - -;
#X obj 246 638 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X text 43 535 If you ask for "tracks" \, the output is four numbers:
index \, frequency \, and amplitude as before \, and finally a flag
which is one for a new track \, zero for a continuation \, minus one
for an empty track.;
#X obj 205 662 sigmund~ -npts 16384 -hop 8192 -npeak 1 tracks;
#X connect 0 0 4 0;
#X connect 1 0 0 0;
#X connect 2 0 9 0;
#X connect 3 0 1 0;
#X connect 4 0 5 0;
#X connect 4 9 11 0;
#X connect 5 0 6 0;
#X connect 5 1 7 0;
#X connect 5 2 8 0;
#X connect 5 3 10 0;
#X connect 9 0 3 0;
#X connect 11 0 12 0;
#X connect 11 1 13 0;
#X connect 11 2 14 0;
#X connect 11 3 15 0;
#X connect 23 0 24 0;
#X connect 24 0 32 0;
#X connect 25 0 26 0;
#X connect 25 1 27 0;
#X connect 25 2 28 0;
#X connect 25 3 29 0;
#X connect 30 0 24 1;
#X connect 32 0 25 0;
#X restore 1690 519 pd sinusoid-tracking;
#X text 1547 185 tracks - output sinusoidal peaks organized into tracks
;
#X text 1551 131 notes - output pitch at the beginning of notes;
#X text 1699 496 more details:;
#X text 1505 204 Parameters you may set (in creation arguments or messages):
;
#X text 1555 227 npts - number of points in each analysis window (1024)
;
#X text 1555 245 hop - number of points between each analysis (512)
;
#X text 1555 262 npeak - number of sinusoidal peaks (20);
#X text 1556 338 vibrato - depth of vibrato to expect in 1/2-tones
(1);
#X text 1549 167 peaks - output all sinusoidal peaks in order of amplitude
;
#X text 1506 415 The npts and hop parameters are in samples \, and
are powers of two. The example below specifies a huge hop of 4096 (to
slow the output down) and to output "pitch" and "env". (Those are the
default outputs.);
#X text 1556 280 maxfreq - maximum sinusoid frequency in Hz. (1000000)
;
#X text 1550 148 env - output amplitude continuously;
#X text 1616 301 (... the 4 parameters below affect only note detection
\, not raw pitch:), f 36;
#X text 1555 357 stabletime - time (msec) to wait to report notes (50)
;
#X text 1557 375 minpower - minimum power (dB) to report a note (50)
;
#X text 1557 394 growth - growth (dB) to report a repeated note (7)
;
#X text 1689 595 updated for Pd v0.46;
#X obj 1005 187 *~ 1;
#X obj 1554 528 s bang;
#X obj 918 13 r bang;
#X msg 1051 145 1;
#X msg 991 38 \; pd dsp 1;
#X floatatom 159 276 5 0 0 0 - - -;
#X obj 85 340 > 30;
#X obj 181 339 < 15;
#X obj 159 236 env~ 128;
#X msg 59 260 30;
#X obj 199 309 / 2;
#X floatatom 64 289 5 0 0 0 - - -;
#X obj 92 374 sel 1;
#X obj 184 376 sel 1;
#X msg 103 459 1;
#X msg 188 463 0;
#X obj 173 526 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 119 431 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 204 424 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 144 494 change;
#X obj 211 527 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 806 295 table sampler 144000;
#X obj 535 312 tabwrite~ sampler;
#X obj 644 224 sel 1 0;
#X msg 631 252 stop;
#X obj 632 457 tabread~ sampler;
#X obj 686 390 phasor~;
#X obj 686 426 *~ 1;
#X obj 690 277 timer;
#X obj 690 306 t b f f;
#X obj 798 378 * 48;
#X obj 689 360 /;
#X msg 687 333 1000;
#X obj 608 25 adc~ 1 2;
#X floatatom 1056 249 5 0 0 0 - - -;
#X obj 1054 213 env~ 128;
#X obj 1180 198 vu 15 120 empty empty -1 -8 0 10 -66577 -1 1 0;
#X obj 1121 237 - 100;
#X obj 169 201 *~ 1;
#X floatatom 272 109 5 0 120 0 - - -;
#X obj 655 568 dac~;
#X obj 659 509 *~ 1;
#X floatatom 737 519 5 0 120 0 - - -;
#X obj 797 456 r bang;
#X msg 768 497 1;
#X msg 309 82 2;
#X obj 120 80 r bang;
#X obj 221 967 noteout;
#X floatatom 386 647 5 0 127 0 - - -;
#X text 419 648 amp;
#X floatatom 317 661 5 0 127 0 - - -;
#X text 279 662 midi;
#X obj 301 717 makenote 127 1000;
#X obj 329 582 route -1500;
#X obj 394 552 sigmund~ pitch env;
#X obj 261 874 spigot;
#X obj 284 831 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 281 800 > 25;
#X obj 237 750 pack;
#X obj 240 896 unpack;
#X floatatom 236 928 5 0 0 0 - - -;
#X floatatom 288 925 5 0 0 0 - - -;
#X msg 859 355 44;
#X msg 911 371 48;
#X obj 927 334 r bang;
#X floatatom 865 396 5 0 0 0 - - -;
#X msg 959 393 32;
#X connect 2 0 26 0;
#X connect 3 0 25 1;
#X connect 25 0 60 0;
#X connect 25 0 47 0;
#X connect 25 0 79 0;
#X connect 27 0 28 0;
#X connect 27 0 29 0;
#X connect 28 0 3 0;
#X connect 30 0 31 0;
#X connect 30 0 32 0;
#X connect 31 0 37 0;
#X connect 32 0 38 0;
#X connect 33 0 30 0;
#X connect 34 0 36 0;
#X connect 35 0 32 1;
#X connect 36 0 31 1;
#X connect 36 0 35 0;
#X connect 37 0 42 0;
#X connect 38 0 43 0;
#X connect 39 0 44 0;
#X connect 40 0 44 0;
#X connect 41 0 48 0;
#X connect 42 0 39 0;
#X connect 43 0 40 0;
#X connect 44 0 45 0;
#X connect 44 0 41 0;
#X connect 48 0 47 0;
#X connect 48 0 53 0;
#X connect 48 1 49 0;
#X connect 48 1 53 1;
#X connect 49 0 47 0;
#X connect 50 0 66 0;
#X connect 51 0 52 0;
#X connect 52 0 50 0;
#X connect 53 0 54 0;
#X connect 54 0 57 0;
#X connect 54 1 56 1;
#X connect 54 2 55 0;
#X connect 55 0 52 1;
#X connect 56 0 51 0;
#X connect 57 0 56 0;
#X connect 58 0 63 0;
#X connect 58 1 25 0;
#X connect 60 0 59 0;
#X connect 60 0 62 0;
#X connect 62 0 61 0;
#X connect 63 0 33 0;
#X connect 64 0 63 1;
#X connect 66 0 65 0;
#X connect 66 0 65 1;
#X connect 67 0 66 1;
#X connect 68 0 69 0;
#X connect 69 0 67 0;
#X connect 70 0 64 0;
#X connect 71 0 70 0;
#X connect 71 0 34 0;
#X connect 73 0 77 1;
#X connect 73 0 77 2;
#X connect 73 0 82 0;
#X connect 75 0 77 0;
#X connect 77 0 83 0;
#X connect 77 1 83 1;
#X connect 78 1 75 0;
#X connect 79 0 78 0;
#X connect 79 1 73 0;
#X connect 80 0 84 0;
#X connect 81 0 80 1;
#X connect 82 0 81 0;
#X connect 83 0 80 0;
#X connect 84 0 85 0;
#X connect 84 1 86 0;
#X connect 85 0 72 0;
#X connect 86 0 72 1;
#X connect 87 0 90 0;
#X connect 88 0 90 0;
#X connect 89 0 87 0;
#X connect 90 0 55 1;
#X connect 91 0 90 0;
