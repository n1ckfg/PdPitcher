#N canvas 203 377 1204 594 10;
#X text 817 8 sigmund~ - sinusoidal analysis and pitch tracking;
#N canvas 432 117 573 597 using-with-tables 0;
#X obj 29 368 print peak;
#N canvas 0 50 450 300 (subpatch) 0;
#X array insignal 1024 float 2;
#X coords 0 1 1023 -1 200 140 1;
#X restore 83 426 graph;
#X obj 314 513 phasor~;
#X obj 294 429 loadbang;
#X obj 314 461 440;
#X floatatom 313 488 5 0 0 0 - - -;
#X obj 305 544 tabwrite~ insignal;
#X obj 290 516 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X text 114 11 Using sigmund~ on arrays;
#X text 42 33 If invoked with the "-t" flag (as a creation argument)
\, sigmund~ analyzes waveforms stored in arrays. Instead of an incoming
signal \, feed it "list" messages with the following arguments:;
#X text 37 118 table name (a symbol);
#X text 38 137 number of points;
#X obj 29 342 sigmund~ -t -npeak 10 -maxfreq 5000 peaks;
#X msg 29 316 list insignal 1024 0 44100 0;
#X text 37 158 index of first point;
#X text 39 179 sample rate;
#X text 38 200 debug flag (print debugging info if nonzero);
#X text 23 232 In this mode \, only the "env" \, "pitch" \, and "peaks"
outputs are meaningful.;
#X text 31 294 click here to test:;
#X connect 2 0 6 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 2 0;
#X connect 5 0 7 0;
#X connect 7 0 6 0;
#X connect 12 0 0 0;
#X connect 13 0 12 0;
#X restore 970 548 pd using-with-tables;
#X obj 819 468 loadbang;
#X floatatom 394 73 5 0 120 0 - - -;
#X text 788 32 Sigmund~ analyzes an incoming sound into sinusoidal
components \, which may be reported individually or combined to form
a pitch estimate. Possible outputs are specified as creation arguments:
;
#X text 831 99 pitch - output pitch continuously;
#N canvas 517 73 588 728 setting-parameters 0;
#X msg 182 66 print;
#X floatatom 192 92 5 0 0 0 - - -;
#X msg 192 113 minpower \$1;
#X obj 182 139 sigmund~ -minpower 40;
#X text 39 14 You can set parameters either by creation arguments \,
or else using messages. The "print" message gives you the current values
of all the parameters:;
#X text 28 169 npts: number of points used in an analysis. Must be
a power of two \, at least 128 The minimum frequency that can be tracked
is about 2(sample_rate)/npts.;
#X text 26 219 hop: number of points between analyses. Must be a power
of two \, at least the DSP vector size (usually 64). This regulates
the number of analyses done per unit of time.;
#X text 28 271 npeak: maximum number of sinusoidal peaks to look for.
The computation time is quadratic in the number of peaks actually found
(this number only sets an upper limit). Use it to balance CPU time
with quality of results.;
#X text 30 336 maxfreq: maximum frequency of sinusoidal peaks to look
for. This can be useful in situations where background noise creates
high-frequency \, spurious peaks..;
#X text 37 388 vibrato: maximum deviation from "pitch" to accept as
normal vibrato (affects "notes" output only). If the value is too small.
vibratos will appear as trills. If too large \, very small melodic
intervals may not be reported as new notes.;
#X text 33 457 stabletime: time period to wait before reporting a note
(affects "notes" output only). The "pitch" must be present and must
not vary more than "vibrato" for this entire period to report a note.
If too large \, the "notes" will be unnecessarily delayed. If too small
\, spurious notes get output.;
#X text 34 606 growth: minimum measured RMS growth to report a new
note (affects "notes" output only). The RMS level must rise by this
many dB (within a time period given by "stabletime") to report a repetition
of a note at or near the previously output pitch.;
#X text 33 555 minpower: minimum measured RMS level to report a pitch
(affects "notes" output only). Signals quieter than this will be assumed
to be crosstalk and ignored.;
#X connect 0 0 3 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X restore 970 526 pd setting-parameters;
#N canvas 67 50 641 815 sinusoid-tracking 0;
#X obj 124 267 sigmund~ -npeak 10 peaks;
#X obj 124 214 phasor~;
#X obj 124 144 loadbang;
#X floatatom 124 190 5 0 120 0 - - -;
#X obj 124 295 route 0 1 2 3 4 5 6 7 8 9;
#X obj 82 339 unpack 0 0 0 0;
#X floatatom 82 461 5 0 0 0 - - -;
#X floatatom 122 431 5 0 0 0 - - -;
#X floatatom 162 406 5 0 0 0 - - -;
#X obj 124 167 440;
#X floatatom 203 380 5 0 0 0 - - -;
#X obj 322 349 unpack 0 0 0 0;
#X floatatom 322 471 5 0 0 0 - - -;
#X floatatom 362 441 5 0 0 0 - - -;
#X floatatom 402 416 5 0 0 0 - - -;
#X floatatom 443 390 5 0 0 0 - - -;
#X text 385 475 frequency (Hz.);
#X text 419 442 peak amplitude (linear);
#X text 464 416 cosine component;
#X text 499 390 sine component;
#X text 79 505 loudest partial;
#X text 332 508 quietest partial;
#X text 36 4 You can ask for sinusoidal peaks in decreasing order of
amplitude or arranged into maximally continuous tracks for resynthesis.
(Or you can ask for both.) If you ask for peaks \, out come lists of
five numbers \, one for each sinusoid at each analysis period. The
first is the index number of the sinusoid (so you can use "route" to
claw them apart). The other four are as shown:;
#X obj 204 611 osc~ 440;
#X obj 204 635 *~;
#X obj 205 689 unpack 0 0 0 0;
#X floatatom 205 782 5 0 0 0 - - -;
#X floatatom 245 760 5 0 0 0 - - -;
#X floatatom 285 737 5 0 0 0 - - -;
#X floatatom 326 713 5 0 0 0 - - -;
#X obj 246 638 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X text 43 535 If you ask for "tracks" \, the output is four numbers:
index \, frequency \, and amplitude as before \, and finally a flag
which is one for a new track \, zero for a continuation \, minus one
for an empty track.;
#X obj 205 662 sigmund~ -npts 16384 -hop 8192 -npeak 1 tracks;
#X connect 0 0 4 0;
#X connect 1 0 0 0;
#X connect 2 0 9 0;
#X connect 3 0 1 0;
#X connect 4 0 5 0;
#X connect 4 9 11 0;
#X connect 5 0 6 0;
#X connect 5 1 7 0;
#X connect 5 2 8 0;
#X connect 5 3 10 0;
#X connect 9 0 3 0;
#X connect 11 0 12 0;
#X connect 11 1 13 0;
#X connect 11 2 14 0;
#X connect 11 3 15 0;
#X connect 23 0 24 0;
#X connect 24 0 32 0;
#X connect 25 0 26 0;
#X connect 25 1 27 0;
#X connect 25 2 28 0;
#X connect 25 3 29 0;
#X connect 30 0 24 1;
#X connect 32 0 25 0;
#X restore 970 503 pd sinusoid-tracking;
#X text 827 169 tracks - output sinusoidal peaks organized into tracks
;
#X text 831 115 notes - output pitch at the beginning of notes;
#X text 979 480 more details:;
#X text 785 188 Parameters you may set (in creation arguments or messages):
;
#X text 835 211 npts - number of points in each analysis window (1024)
;
#X text 835 229 hop - number of points between each analysis (512)
;
#X text 835 246 npeak - number of sinusoidal peaks (20);
#X text 836 322 vibrato - depth of vibrato to expect in 1/2-tones (1)
;
#X text 829 151 peaks - output all sinusoidal peaks in order of amplitude
;
#X text 786 399 The npts and hop parameters are in samples \, and are
powers of two. The example below specifies a huge hop of 4096 (to slow
the output down) and to output "pitch" and "env". (Those are the default
outputs.);
#X text 836 264 maxfreq - maximum sinusoid frequency in Hz. (1000000)
;
#X text 830 132 env - output amplitude continuously;
#X text 896 285 (... the 4 parameters below affect only note detection
\, not raw pitch:), f 36;
#X text 835 341 stabletime - time (msec) to wait to report notes (50)
;
#X text 837 359 minpower - minimum power (dB) to report a note (50)
;
#X text 837 378 growth - growth (dB) to report a repeated note (7)
;
#X text 969 579 updated for Pd v0.46;
#X obj 315 51 adc~ 1;
#X obj 338 80 *~ 1;
#X obj 834 512 s bang;
#X obj 482 54 r bang;
#X obj 68 550 noteout;
#X floatatom 233 230 5 0 127 0 - - -;
#X text 266 231 amp;
#X floatatom 164 244 5 0 127 0 - - -;
#X text 126 245 midi;
#X obj 148 300 makenote 127 1000;
#X obj 176 165 route -1500;
#X obj 241 135 sigmund~ pitch env;
#X msg 397 48 1;
#X msg 546 113 \; pd dsp 1;
#N canvas 843 194 865 667 arp 0;
#X obj 266 485 +~;
#X obj 263 186 +;
#X obj 306 186 f;
#X msg 263 162 1;
#X obj 290 239 sel 1;
#X msg 306 162 0;
#X obj 261 358 osc~ 220;
#X msg 263 78 1;
#X obj 314 84 r Channel-A;
#X obj 290 263 r Channel-B;
#X obj 443 211 r Channel-C;
#X obj 441 402 line~;
#X obj 535 362 r Channel-D;
#X obj 439 482 *~ 0.3;
#X msg 743 213 0.3;
#X obj 263 136 metro 300;
#X obj 290 301 * 440;
#X msg 398 310 440;
#X msg 407 245 220;
#X obj 432 529 delwrite~ del 1000;
#X obj 446 252 * 600;
#X obj 392 84 hsl 128 15 0 1 0 0 empty empty empty -2 -8 0 10 -262144
-1 -1 2000 1;
#X obj 350 186 hsl 128 15 0 1 0 0 empty empty empty -2 -8 0 10 -262144
-1 -1 1800 1;
#X obj 538 216 hsl 128 15 0 1 0 0 empty empty empty -2 -8 0 10 -262144
-1 -1 1200 1;
#X obj 537 336 hsl 128 15 0 1 0 0 empty empty empty -2 -8 0 10 -262144
-1 -1 2100 1;
#X obj 441 446 vd~ del;
#X obj 452 275 + 20;
#X obj 290 215 > 4;
#X obj 268 321 * 150;
#X obj 314 113 * 1000;
#X msg 443 305 \$1 20;
#X msg 329 370 0 300;
#X obj 347 338 t b b;
#X obj 305 415 line~;
#X obj 267 446 *~;
#X obj 387 370 1;
#X obj 264 556 outlet~;
#X obj 654 24 r bang;
#X obj 76 256 inlet;
#X connect 0 0 36 0;
#X connect 1 0 2 0;
#X connect 1 0 27 0;
#X connect 1 0 28 0;
#X connect 2 0 1 1;
#X connect 3 0 1 0;
#X connect 4 0 5 0;
#X connect 5 0 2 0;
#X connect 6 0 34 0;
#X connect 7 0 15 0;
#X connect 7 0 29 0;
#X connect 8 0 29 0;
#X connect 9 0 16 0;
#X connect 10 0 20 0;
#X connect 11 0 25 0;
#X connect 12 0 13 1;
#X connect 13 0 19 0;
#X connect 14 0 13 1;
#X connect 15 0 3 0;
#X connect 15 0 32 0;
#X connect 16 0 28 1;
#X connect 17 0 28 1;
#X connect 18 0 30 0;
#X connect 20 0 26 0;
#X connect 21 0 29 0;
#X connect 22 0 16 0;
#X connect 23 0 20 0;
#X connect 24 0 13 1;
#X connect 25 0 0 1;
#X connect 25 0 13 0;
#X connect 26 0 30 0;
#X connect 27 0 4 0;
#X connect 29 0 15 1;
#X connect 30 0 11 0;
#X connect 31 0 33 0;
#X connect 32 0 31 0;
#X connect 32 1 35 0;
#X connect 33 0 34 1;
#X connect 34 0 0 0;
#X connect 34 0 19 0;
#X connect 35 0 33 0;
#X connect 37 0 7 0;
#X connect 37 0 14 0;
#X connect 37 0 17 0;
#X connect 37 0 18 0;
#X connect 38 0 6 0;
#X restore 353 302 pd arp;
#X obj 425 518 dac~;
#X obj 297 289 mtof;
#X floatatom 286 319 5 0 0 0 - - -;
#N canvas 0 50 1009 833 fm 0;
#X obj 119 515 *~;
#X obj 478 62 r \$0-trigger;
#X obj 682 483 bng 25 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 685 17 hsl 128 15 0 1 0 0 empty empty Fmod -2 -8 0 10 -262144
-1 -1 3810 1;
#X obj 689 101 hsl 128 15 0 1 0 0 empty empty Indice -2 -8 0 10 -262144
-1 -1 5100 1;
#X obj 684 201 hsl 128 15 0 1 0 0 empty empty Attack -2 -8 0 10 -262144
-1 -1 3810 1;
#X obj 686 392 hsl 128 15 0 1 0 0 empty empty Delay -2 -8 0 10 -262144
-1 -1 1200 1;
#X obj 689 419 r Channel-E;
#X obj 716 483 r Channel-Push;
#X obj 50 253 mtof;
#X obj 172 97 > 0;
#X obj 172 119 sel 1;
#X obj 172 143 s \$0-trigger;
#N canvas 16 204 450 300 polySteal 0;
#X obj 124 19 inlet;
#X obj 225 22 inlet;
#X obj 136 226 outlet;
#X obj 283 227 outlet;
#X obj 210 121 > 0;
#X obj 210 143 sel 1;
#X obj 210 99 i;
#X obj 136 196 i;
#X obj 124 41 t b f;
#X obj 283 196 i;
#X connect 0 0 8 0;
#X connect 1 0 6 1;
#X connect 1 0 9 1;
#X connect 4 0 5 0;
#X connect 5 0 7 0;
#X connect 5 0 9 0;
#X connect 6 0 4 0;
#X connect 7 0 2 0;
#X connect 8 0 6 0;
#X connect 8 1 7 1;
#X connect 9 0 3 0;
#X restore 102 66 pd polySteal;
#X obj 269 247 mtof;
#X obj 269 222 +, f 5;
#X obj 268 120 * 36;
#X obj 391 91 > 0;
#X obj 391 113 sel 1;
#X obj 391 137 s \$0-trigger;
#X obj 268 164 t b f;
#X obj 269 196 i;
#X obj 268 142 + 12;
#X obj 112 316 *~;
#X obj 92 390 +~;
#X obj 102 466 osc~;
#X obj 107 273 osc~;
#X obj 682 164 s \$0-indice;
#X obj 284 274 r \$0-indice;
#X obj 683 65 s \$0-fmod;
#X obj 268 98 r \$0-fmod;
#X obj 107 365 *~;
#X obj 693 36 r Channel-A;
#X obj 696 128 r Channel-B;
#X obj 692 230 r Channel-C;
#X obj 690 325 r Channel-D;
#X obj 681 298 hsl 128 15 0 1 0 0 empty empty Release -2 -8 0 10 -262144
-1 -1 3810 1;
#X obj 472 206 pack f f;
#X obj 562 221 pack f f;
#X obj 557 185 sel 0;
#X msg 504 247 0 \$2;
#X msg 395 246 1 \$2;
#X obj 499 95 r \$0-Attack;
#X obj 586 92 r \$0-Release;
#X obj 683 353 s \$0-Release;
#X obj 686 258 s \$0-Attack;
#X obj 283 304 * 5000;
#X obj 94 426 +~;
#X obj 682 553 s \$1-stop;
#X obj 565 272 r \$1-stop;
#X obj 499 117 * 15000;
#X obj 586 114 * 15000;
#X obj 480 284 line~;
#X obj 121 608 +~;
#X obj 232 612 +~;
#X obj 404 514 *~;
#X obj 67 564 *~ 0.25;
#X obj 151 565 *~ 0.25;
#X obj 320 419 *~ 0.25;
#X obj 320 442 *~ 0.25;
#X obj 683 447 s \$0-delay;
#X obj 431 355 r \$0-delay;
#X obj 439 406 line~;
#X obj 433 385 pack 0 1000;
#X obj 714 521 sel 1;
#X msg 548 313 stop;
#X obj 338 544 vd~ pippo 10;
#X obj 475 543 vd~ pippo 20;
#X obj 330 480 delwrite~ pippo 2000;
#X obj 383 430 *~ 2000;
#X obj 521 421 *~ 1980;
#X obj 423 603 *~ 0.9;
#X obj 193 13 inlet;
#X msg 297 26 63, f 4;
#X obj 247 672 outlet~;
#X obj 871 197 r bang;
#X msg 873 237 0.3;
#X connect 0 0 56 0;
#X connect 0 0 57 0;
#X connect 0 0 58 0;
#X connect 0 0 59 0;
#X connect 1 0 37 0;
#X connect 2 0 48 0;
#X connect 3 0 29 0;
#X connect 4 0 27 0;
#X connect 5 0 45 0;
#X connect 6 0 60 0;
#X connect 7 0 60 0;
#X connect 8 0 64 0;
#X connect 9 0 24 0;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X connect 13 0 9 0;
#X connect 13 0 21 0;
#X connect 13 1 10 0;
#X connect 13 1 17 0;
#X connect 14 0 26 0;
#X connect 15 0 14 0;
#X connect 16 0 22 0;
#X connect 17 0 18 0;
#X connect 18 0 19 0;
#X connect 20 0 21 0;
#X connect 20 1 15 1;
#X connect 21 0 15 0;
#X connect 22 0 20 0;
#X connect 23 0 31 0;
#X connect 24 0 47 0;
#X connect 25 0 0 0;
#X connect 26 0 23 0;
#X connect 28 0 46 0;
#X connect 30 0 16 0;
#X connect 31 0 24 1;
#X connect 32 0 29 0;
#X connect 33 0 27 0;
#X connect 34 0 45 0;
#X connect 35 0 44 0;
#X connect 36 0 44 0;
#X connect 37 0 41 0;
#X connect 38 0 40 0;
#X connect 39 0 38 0;
#X connect 40 0 52 0;
#X connect 41 0 52 0;
#X connect 42 0 50 0;
#X connect 43 0 51 0;
#X connect 46 0 23 1;
#X connect 47 0 25 0;
#X connect 49 0 65 0;
#X connect 50 0 37 1;
#X connect 51 0 38 1;
#X connect 52 0 0 1;
#X connect 52 0 31 1;
#X connect 53 0 74 0;
#X connect 54 0 74 0;
#X connect 55 0 71 0;
#X connect 56 0 53 0;
#X connect 57 0 54 0;
#X connect 59 0 68 0;
#X connect 61 0 63 0;
#X connect 62 0 55 1;
#X connect 62 0 69 0;
#X connect 62 0 70 0;
#X connect 63 0 62 0;
#X connect 64 0 48 0;
#X connect 65 0 52 0;
#X connect 66 0 53 1;
#X connect 66 0 55 0;
#X connect 67 0 54 1;
#X connect 69 0 66 0;
#X connect 70 0 67 0;
#X connect 71 0 68 0;
#X connect 72 0 13 0;
#X connect 72 0 73 0;
#X connect 73 0 13 1;
#X connect 73 0 39 0;
#X connect 75 0 76 0;
#X connect 76 0 36 0;
#X connect 76 0 5 0;
#X connect 76 0 3 0;
#X restore 481 304 pd fm;
#X f 8;
#X floatatom 566 366 5 0 0 0 - - -;
#X msg 568 335 0.2;
#X obj 222 422 spigot;
#X obj 304 407 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 108 457 spigot;
#X obj 131 414 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 128 383 > 25;
#X obj 84 333 pack;
#X obj 87 479 unpack;
#X floatatom 218 464 5 0 0 0 - - -;
#X obj 331 344 / 2;
#X obj 319 473 / 8;
#X floatatom 83 511 5 0 0 0 - - -;
#X floatatom 135 508 5 0 0 0 - - -;
#X obj 429 454 *~ 1;
#X obj 530 406 * 1;
#X obj 312 373 > 200 && < 1500;
#X connect 2 0 27 0;
#X connect 3 0 26 1;
#X connect 25 0 26 0;
#X connect 26 0 36 0;
#X connect 28 0 37 0;
#X connect 28 0 38 0;
#X connect 28 0 45 0;
#X connect 30 0 34 1;
#X connect 30 0 34 2;
#X connect 30 0 50 0;
#X connect 32 0 34 0;
#X connect 34 0 51 0;
#X connect 34 1 51 1;
#X connect 35 1 32 0;
#X connect 36 0 35 0;
#X connect 36 1 30 0;
#X connect 37 0 3 0;
#X connect 39 0 58 0;
#X connect 41 0 42 0;
#X connect 42 0 46 0;
#X connect 42 0 60 0;
#X connect 43 0 58 0;
#X connect 44 0 59 0;
#X connect 45 0 44 0;
#X connect 46 0 53 0;
#X connect 46 0 54 0;
#X connect 47 0 46 1;
#X connect 47 0 59 1;
#X connect 47 0 45 0;
#X connect 48 0 52 0;
#X connect 49 0 48 1;
#X connect 50 0 49 0;
#X connect 51 0 48 0;
#X connect 52 0 41 0;
#X connect 52 0 56 0;
#X connect 52 1 57 0;
#X connect 53 0 55 0;
#X connect 54 0 39 0;
#X connect 55 0 43 0;
#X connect 56 0 29 0;
#X connect 57 0 29 1;
#X connect 58 0 40 0;
#X connect 58 0 40 1;
#X connect 59 0 58 1;
#X connect 60 0 47 0;
